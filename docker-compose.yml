version: '3.8'

services:
    service:
        image: "${DOCKER_USERNAME}/${DOCKER_REPO}:${BUILD_TAG}"
        container_name: "${SERVICE_NAME}"
        environment:
          - ENV_NAME=${ENV_NAME}
          - NODE_ENV=production
          - GOOGLE_CLIENT_ID=your-google-client-id
          - FIREBASE_API_KEY=your-firebase-api-key
          - FIREBASE_AUTH_DOMAIN=web.firebaseapp.com
          - FIREBASE_PROJECT_ID=web
          - FIREBASE_STORAGE_BUCKET=web.appspot.com
          - FIREBASE_MESSAGING_SENDER_ID=your-firebase-messaging-sender-id
          - FIREBASE_APP_ID=your-firebase-app-id
        networks: # REQUIRED: Should be 'public' to join into docker swarm.
          - public
        ports:
          - "${SERVICE_PORT}:${DOCKER_FILE_PORT}"
        deploy:
          mode: replicated
          replicas: 1
          placement:
            constraints: 
              - node.platform.os == linux
          labels:
            - "traefik.enable=true"
            - "traefik.http.routers.${SERVICE_NAME}.rule=Host(`${SERVICE_DOMAIN}`)"
            - "traefik.http.routers.${SERVICE_NAME}.entrypoints=websecure" # Can be 'web' to refer http instead.
            - "traefik.http.services.${SERVICE_NAME}.loadbalancer.server.port=${SERVICE_PORT}"
            - "traefik.http.routers.${SERVICE_NAME}.service=${SERVICE_NAME}"
            - "traefik.http.routers.${SERVICE_NAME}.tls.certresolver=leresolver"
            
networks:
  public:
    external: true
